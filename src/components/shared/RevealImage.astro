---
const {
  imageUrl,
  alt = "",
  animationDuration = 1.5,
  id = `reveal-${Math.random().toString(36).slice(2)}`,
} = Astro.props;
---

<div id={id} class="container">
  <div class="reveal">
    <img src={imageUrl} alt={alt} />
  </div>
</div>

<style>
  .container {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: fit-content;
    width: fit-content;
    position: relative;
    overflow: hidden;
    border-radius: 16px;
  }

  img {
    height: 100%;
    width: 100%;
    object-fit: cover;
    transform-origin: left;
  }

  .reveal {
    visibility: hidden;
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    border-radius: 16px;
  }
</style>

<script is:inline define:vars={{ id, animationDuration }}>
  document.addEventListener("astro:page-load", () => {
    gsap.registerPlugin(ScrollTrigger);

    // Use the provided unique id to scope the query
    const container = document.getElementById(id);
    if (container) {
      const reveal = container.querySelector(".reveal");
      if (reveal) {
        const image = reveal.querySelector("img");
        const tl = gsap.timeline({
          scrollTrigger: {
            trigger: reveal,
            start: "top 80%",
            toggleActions: "restart none none reset",
            once: true,
          },
        });

        tl.set(reveal, { autoAlpha: 1 });
        tl.from(reveal, {
          duration: animationDuration,
          xPercent: -100,
          ease: "power2.out",
        });
        tl.from(image, {
          duration: animationDuration,
          xPercent: 100,
          scale: 1.3,
          delay: -animationDuration,
          ease: "power2.out",
        });
      }
    }
  });
</script>
